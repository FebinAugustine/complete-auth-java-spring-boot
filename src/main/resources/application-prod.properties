# Production profile overrides
spring.profiles=prod

# Datasource - require apps to supply full JDBC URL via env
spring.datasource.url=${DB_URL:jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useSSL=true&serverTimezone=UTC}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# JPA - never auto-update in prod
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.format_sql=false

# Flyway - enabled, but baseline-on-migrate disabled by default for prod
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=false
spring.flyway.locations=classpath:db/migration

# Server port (override via env)
server.port=${SERVER_PORT:8080}

# JWT - must be supplied by env/secret manager
jwt.secret=${JWT_SECRET}
jwt.access-token-validity-ms=${JWT_ACCESS_TOKEN_VALIDITY_MS:900000}
jwt.refresh-token-validity-ms=${JWT_REFRESH_TOKEN_VALIDITY_MS:604800000}

# Cookies - secure + strict in prod
app.cookie.secure=true
app.cookie.sameSite=Strict

# OAuth config - supply client ids/secrets from secret manager
app.oauth2.success-redirect=${APP_OAUTH2_SUCCESS_REDIRECT:https://app.example.com/oauth-success}
spring.security.oauth2.client.registration.google.client-id=${OAUTH2_GOOGLE_CLIENT_ID}
spring.security.oauth2.client.registration.google.client-secret=${OAUTH2_GOOGLE_CLIENT_SECRET}
spring.security.oauth2.client.registration.github.client-id=${OAUTH2_GITHUB_CLIENT_ID}
spring.security.oauth2.client.registration.github.client-secret=${OAUTH2_GITHUB_CLIENT_SECRET}
app.base-url=${APP_BASE_URL:https://api.example.com}

# Redis for distributed rate limiting, session, cache, etc. (required for Bucket4j distributed)
redis.uri=${REDIS_URI:redis://localhost:6379}

# Rate-limit - tighter production defaults (tune based on traffic)
app.rate-limit.enabled=true
app.rate-limit.usePerAccountForLogin=true

app.rate-limit.default.capacity=100
app.rate-limit.default.refillTokens=100
app.rate-limit.default.refillPeriodSeconds=60

app.rate-limit.endpoints./api/auth/password/strength.capacity=30
app.rate-limit.endpoints./api/auth/password/strength.refillTokens=30
app.rate-limit.endpoints./api/auth/password/strength.refillPeriodSeconds=60

app.rate-limit.endpoints./api/auth/signup.capacity=5
app.rate-limit.endpoints./api/auth/signup.refillTokens=5
app.rate-limit.endpoints./api/auth/signup.refillPeriodSeconds=300

app.rate-limit.endpoints./api/auth/login.capacity=20
app.rate-limit.endpoints./api/auth/login.refillTokens=20
app.rate-limit.endpoints./api/auth/login.refillPeriodSeconds=60

# Production logging defaults
logging.level.root=INFO
logging.level.org.springframework=INFO
logging.level.com.example=INFO

# Security: recommended server settings (example placeholders)
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.probes.enabled=true
